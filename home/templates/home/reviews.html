{# templates/home/reviews.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Reviews – Film Reviews{% endblock %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/style_reviews.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/reviews.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="reviews-section">
  <div class="list-of-reviews">
    <h2>List of reviews</h2>
  </div>

  <div class="movie-gallery">
    {% for review in reviews %}
      <div class="movie-card">
        <img src="{{ review.movie.image.url }}" alt="{{ review.movie.name }}">
        <div class="movie-review">
          <h2>
            <a href="{% url 'movie_description' review.movie.id %}">
              {{ review.movie.name }}
            </a>
          </h2>

          <h3>
            User:
            <strong>
              {% if review.user %}{{ review.user.username }}{% else %}{{ review.name }}{% endif %}
            </strong>
            &nbsp; Date: {{ review.add_date|date:"d.m.Y" }}
          </h3>

          <p class="review-stars" aria-label="Rating {{ review.rating }} out of 5">
            {% for i in "12345" %}
              <span class="star{% if forloop.counter <= review.rating %} filled{% endif %}">★</span>
            {% endfor %}
            <span class="rating-number">({{ review.rating }}/5)</span>
          </p>

          <p>{{ review.review }}</p>

          <p style="margin-top:6px; font-size: 0.9em; color:#aaa;">
            Review ID: {{ review.id }}
          </p>
        </div>
      </div>
    {% empty %}
      <p>No reviews yet.</p>
    {% endfor %}

    <div class="movie-add-new" id="openAddReviewModal">
      <div class="film-card add-new">
        <div class="add-placeholder">
          <span>ADD NEW REVIEW</span>
        </div>
      </div>
    </div>
  </div>

  {# Pagination #}
  {% if reviews.paginator.num_pages > 1 %}
    <div class="pagination">
      <span class="step-links">
        {% if reviews.has_previous %}
          <a class="btn-page" href="?page=1">&laquo; first</a>
          <a class="btn-page" href="?page={{ reviews.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current badge-page">
          Page {{ reviews.number }} of {{ reviews.paginator.num_pages }}
        </span>

        {% if reviews.has_next %}
          <a class="btn-page" href="?page={{ reviews.next_page_number }}">next</a>
          <a class="btn-page" href="?page={{ reviews.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
      </span>
    </div>
  {% endif %}

  {# Modal #}
  <div id="addReviewModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close" aria-label="Close">&times;</span>
      {% include "home/partials/_review_form.html" with movies=movies %}
    </div>
  </div>

  {% if messages %}
    <div class="flash">
      {% for m in messages %}<p>{{ m }}</p>{% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}
